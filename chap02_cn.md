2. Detailed Design 详细设计

2.1 High-Level Architecture  高层次结构

We take Ethereum blockchain as an example to briefly discuss the overall process of an
on-demand data query initiated by a user contract.
It looks similar to the request & response pattern, however, it is an asynchronous process from user contract’s point of view:

我们以Ethereum区块链为例，简要讨论由用户合约发起的按需数据查询的整个过程。
它看起来类似于请求和响应模式，然而，从用户合约的角度来看，它是一个异步的过程:

①: User contract makes a data query request through a message call to
DOS on-chain system (a bunch of smart contracts open sourced and published with well documentation provided to developers), specifically the DOS Proxy Contract;

用户合约通过 对 DOS 链上系统的消息调用发出数据查询请求 (许多智能合约都是开源的并发布的，并向开发人员提供了良好的文档)， 具体是DOS代理合约；


②: DOS Proxy Contract triggers an event along with query parameters;
  DOS代理合约 触发带有查询参数的事件


③: DOS clients (off-chain part of DOS Network running by users), which keep monitoring the blockchain for the defined event, are notified. Ideally there would be thousands of DOS instances running, out of which a registered group will be randomly selected, by means of the distributed randomness engine built with verifiable random function (VRF).

DOS客户端(用户运行的DOS链下部分)， 使用通知的方式保持监控区块链定义的事件。
理想情况下，应该有数千个DOS实例在运行，从这些实例中随机选择一个已注册的组，利用可验证随机函数(VRF)
构建分布式随机引擎。

④ & ⑤: Members in the selected group do the due diligence, calling a web api, performing a computation, or executing a configured script concurrently;

选定组中的成员进行尽职调查， 请求网络api， 执行计算或同时执行已配置的脚本;


⑥: They will reach "in-group" consensus by the t-out-of-n threshold signature algorithm and report back the agreed result to DOS on-chain system, as long as more than t members in the randomly selected group are honest. The selected group members’ identity and QoS (responsiveness/correctness, etc.) performance will be recorded on-chain, for monitoring and data analysis purposes.

他们将达成“in-group”共识， 通过 t-out-n 门限签名算法，并将协议结果反馈给DOS链上系统，
只要随机选取的组中有超过t个成员是诚实的。 选择的组成员的身份和QoS(响应性/正确性等)性能将被记录在链上，
用于监测和数据分析。


⑦: DOS Proxy Contract notifies the user contract that the result is ready, by calling a callback function provided by user contract.

DOS代理合约通过调用用户合约提供的回调函数通知用户合约结果已经就绪。

** The overall workflow of verifiable computation oracle looks similar and also make use
of the distributed randomness engine, but with several differences for step 4~6.
We’ll discuss the details in later sections.

可验证计算oracle的整体工作流程类似，也使用了分布式随机性引擎，但步骤4~6有几个不同之处。
我们将在后面几节中讨论细节。


2.2 On-Chain Detailed Design

2.2.1 Proxy System


The proxy system provides standard on-chain interfaces to user contracts and will
asynchronously callback to user contracts once the response is ready. The interface
provided to user contracts is universal and simple as demonstrated below:

代理系统为用户合约提供标准的链上接口，一旦响应就绪， 就将异步回调给用户合约。
提供给用户合约的接口是通用的、简单的，如下所示:

- Making a query request to DOS Proxy Contract;

向DOS代理合约发送查询请求;

- Consuming the result backfilled from `__callback__` function to finish some
post-processing work.

使用从 `__callback__` 函数中回填的结果，来完成一些后处理工作。

```
code
code
```

Alpha version of DOS on-chain contracts have been open-sourced on Github already
and will be keeping updated.

DOS链上合约的Alpha版本已经在Github上开源并会不断更新。


2.2.2 On-chain Governance Systems 链上管理系统

Monitoring system 监控系统


Monitoring system is proposed to keep on-chain records of the off-chain DOS
instances’ QoS (Quality-of-Service) metrics and network stats, including:

使用监控系统保持链上记录的功能， 对链下DOS实例Qos(服务质量)的指标和网络状态，包括：

- Random number generated by latest round’s selected off-chain group, which
could serve as a new kind of on-chain random source;

由最新一轮选定的链下组产生的随机数， 可以作为一种新的链上随机源;

- Group size, number of registered groups, number of times each registered
group has been selected, uptime and decomposition time to get rid of
adaptive adversaries, etc.;

组的大小， 注册组的数量， 每次注册的小组已被选中的次数，正常运行时间和分解时间， 自动排除对手

- Payment, weight percentage, and callback delay stats of processed and
unhandled query requests;

支付、权重百分比、回调延迟统计和未处理的查询请求;

- Quality score of registered off-chain DOS instances including correctness and
responsiveness of their reported results - instances with extremely bad quality
score will be excluded from off-chain consensus protocol and payment
process;


已注册的链下DOS实例的质量分数，包括正确率和报告结果的响应率- 质量非常差的实例
评分将被排除在链下共识协议和支付过程;

- More...

更多

Based on these rich on-chain metrics a monitoring Dapp could be built, showcasing
the live status of DOS Network.

基于这些丰富的链上指标，可以构建监控Dapp，展示DOS网络的实时状态。


Registration system

For DOS off-chain instances to join the network, they need to stake and lock some
DOS tokens as security deposit, and to register their deposit address as well as
payment address in the registration contract. They will be registered within at least
one threshold group $Gi$ as groups may overlap with each other. The registration
process of threshold groups are described in the off-chain architecture section
below.


The security deposit makes the system resistant to sybil attacks and enhances
network security. It also serves as a kind of commitment that the node operator
would contribute bandwidth and computation power to strengthen DOS Network, and
they will be compensated for “mining” rewards as well as earning processing fees.
The lockup period helps stabilize the network to get rid of too frequent registration
and deregistration flips. Any instance with out-of-bound offtime would also be
penalized by forfeiting part of its deposit. Groups with no responses up to certain
limit would be removed from registration system.


Payment system

The payment of a query request goes to the selected threshold group that handles it,
and is distributed among honest members. Payments will be stored in the payment
contract first, as the transfer to node runners doesn’t necessarily happen in real time
- a withdrawal pattern is preferable and node operators are able to check and
withdraw their earnings through a frontend UI or interacting with payment contract
directly.

DOS token is used in the form of natively supported payment token, as well as the
staking token. However, for blockchains with widely-accepted stablecoins (e.g.
Ethereum), the stablecoin would be a preferable payment token since node runners
won’t be risking for the volatility of crypto prices; the pricing model for the fees will
also be easier to make. We’ll support DOS as payment token first, in the long run,
node runners and token holders will have governance rights to vote for which
stablecoins (DAI/USDC/TUSD/etc.) to be accepted as extra payment tokens.

Different payment schemes will also be supported: pay-per-use will be widely
adopted and suitable for personal developers and light-use Dapps, while discounted
subscription model will be more favorable to heavily dependent applications such as
stablecoins and other decentralized open finance platforms.

The on-chain system will take modular design pattern into mind that all on-chain
contracts will be upgradable. Since it’s an open and distributed network environment
with different parties have different economic appeals, there’s no simple perfect
model to rule them all. More governance experiments and economic models will be
researched and explored in future.


2.4 Cross-Chain Interoperability

DOS Network opens a door to perform cross-chain interaction between
heterogeneous blockchains. Assuming DOS Network supports data feed oracle
services to both Ethereum blockchain and EOS blockchain, then theoretically, smart
contract on Ethereum is able to trigger cross-chain state changes, flowing through
DOS client nodes, calling into smart contract on EOS. DOS Network thus is acting as
connectors or bridges between supported heterogeneous chains.

A simple application is like exchanging heterogenous crypto asset atomically.
Decentralized exchanges nowadays can only trade homogeneous crypto assets in
the same blockchain, decentralized exchanges e.g. EtherDelta or 0x relayers are
unable to trade against EOS tokens directly. However, with the help of DOS
Network, it’s achievable by deploying two DEX contracts on Ethereum and EOS
blockchain respectively and defining two cooperative functions to trigger orderbook
and account balance state changes upon calling from the other DEX contract
address through DOS connectors. This example showcases the potential of DOS
Network in cross-chain interoperability.

The operation and maintenance of any newly supported blockchain’s full node (or
utilizing remote full node services like infura ) is to the node operators’ economic
interests and capability, while DOS Network team is responsible for porting and
deploying on-chain system contracts to newly supported chains and releasing
off-chain core client software including protocol update and new adapter support.
To start up oracle services to newly supported chains we need to go through similar
bootstrapping process as mentioned in section 2.3.1, mainly the one-time group
registration and non-interactive DKG process. Noting that for various supported
blockchains, chain-wide system variables like group size M and number of
registered groups T could be different; the random number r published on different
chains are also different in general.
